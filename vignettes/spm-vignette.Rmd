---
title: "Stochastic Process Model (SPM)"
author: "Ilya Y. Zhbannikov"
date: "`r Sys.Date()`"
output: rmarkdown::pdf_document
vignette: >
  %\VignetteIndexEntry{spm}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Overview

The R-package "spm" (https://github.com/izhbannikov/spm) is developed for modeling aging-related changes and it allows (1) data simulation and (2) estimating the process parameters using maximum likelihood estimation by optimizing some parameters. Specifically, developed R-package spm allows (i) one-dimensional SPM; (ii) multiple dimensional SPM; (iii) data simulation for one- and multiple dimensions.


## Data description

Data represents a typical clinical trait data and must be presented in form of two datasets: longitudinal dataset, in which one record represents a single observation, and vital statistics, where one record represents a patient and other related information. Longitudinal dataset contains person id, status (dead/alive), time and measurements across the covariates. The spm can handle infinite number of covariates but usually 5-7 covariates are enough in practice. 

```{r,results='hide',warning=FALSE,echo=FALSE,message=FALSE}
library(spm)
# Reading longitude data:
longdat <- read.csv(system.file("data","longdat.csv",package="spm"))
# Prepare data for optimization:
vitstat <- read.csv(system.file("data","vitstat.csv",package="spm"))
```


Below there is an example of clinical data that can be used in "spm" and we will discuss the field later.
Longitude data:
```{r,echo=FALSE}
head(longdat)
```
Vital statistics:
```{r,echo=FALSE}
head(vitstat)
```
#### Data fields description
##### Longitude studies
* ID - subject unique identificatin number.
* IndicatorDeath - 0/1, indicates death of a subject.
* Age - current age of subjects.
* AgeNext - next age of subject he will attend to the survey/exam.
* DBP, BMI - covariates, here "DBP" represents a diastolic blood pressure, "BMI" a body-mass index.

##### Vital statistics
* ID - subject's unique ID.
* IsDead - death indicator, 0 - alive, 1 - dead.
* LSmort - age at death of stopping observations.

## Discrete and Continuous cases

### Discrete case
In discrete case, we use the following assumptions:
$$ \bar{y}(t+1) = \bar{u} + \bar{R} \times \bar{y}(t) + \bar{\epsilon} $$
$$ \mu = \mu_0(t) + \bar{b}(t) \times \bar{y}(t) + \bar{Q} \times \bar{y}(t)^2 $$

Where:
$$ \mu_0(t) = \mu_0 e^{\theta t} $$
$$ \bar{b}(t) = \bar{b} e^{\theta t} $$
$$ \bar{Q}(t) = \bar{Q} e^{\theta t} $$

## Continuous case

$$ \mu(u) = \mu_0(u) + (\bar{m}(u) - \bar{f}(u)^* \times \bar{Q}(u) \times (\bar{m}(u) - \bar{f}(u)) + Tr(\bar{Q}(u) \times \bar{\gamma}(u)) $$

$$ dm(t)/dt = \bar{a}(t) \times (\bar{m}(t) - \bar{f_1}(t)) - 2 \bar{\gamma}(t) \times \bar{Q}(t) \times (\bar{m}(t) - \bar{f}(t)) $$
$$ d\bar{\gamma}(t)/dt = \bar{a}(t) \times \bar{\gamma}(t) +  \bar{\gamma}(t) \times \bar{a}(t)^* + \bar{b}(t) \times \bar{b}(t)^* - 2 \bar{\gamma}{t} \times \bar{Q}(t) \times \bar{\gamma}(t) $$

## Coefficient conversion between continuous and discrete cases
$$ Q = Q $$
$$ \bar{a} = \bar{R} - diag(k) $$
$$ \bar{b} = \bar{\epsilon} $$
$$ \bar{f1} = -1 \times \bar{u} \times \bar{a^{-1}} $$
$$ \bar{f} = -0.5 \times \bar{b} \times \bar{Q^{-1}} $$
$$ mu_0 = mu_0 - \bar{f} \times \bar{Q} \times t(\bar{f}) $$
$$ \theta = \theta $$

## Case with time-dependent coefficients

In two previous cases, we assumed that coefficients is sort of time-dependant: we multiplied them on to $$e^{\theta t}$$. In general, this may not be the case. We extend this to a general case, i.e. (we consider one-dimensional case):

$$ \bar{a(t)} = par_1 t + par_2 $$ - linear function. 

The corresponding equations will be equivalent to one-dimensional continuous case described above.

## Simulation

We added one- and multi- dimensional simulation to be able to generate test data for hyphotesis testing. Data,  which can be simulated can be discrete (equal intervals between observations) and continuous (with arbitrary intervals).

## Discrete

For discrete case:

```{r}
library(spm)
data <- sim_discrete(N=100, ystart=c(75, 94), k=2)
head(data)
```

## Continuous

For continuous case:

```{r}
library(spm)
data <- simdata_cont(N=100)
head(data)
```



## More Examples


